<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Generate API Key</title>
<style>
body{
    font-family:sans-serif;
    background:#f3edf9;
    padding:20px;
}
h1{
    text-align:center;
    color:#4b3c8f;
}
.box{
    background:#fff;
    padding:20px;
    border-radius:12px;
    max-width:500px;
    margin:auto;
    margin-bottom:20px;
    box-shadow:0 4px 10px rgba(0,0,0,0.05);
}
input,button{
    width:100%;
    padding:10px;
    margin:5px 0;
    border-radius:8px;
    border:1px solid #ccc;
    box-sizing:border-box;
}
button{
    background:#7c3aed;
    color:#fff;
    border:none;
    cursor:pointer;
    font-weight:600;
}
button:hover{
    opacity:0.9;
}
#status{
    margin-top:10px;
    font-weight:bold;
    text-align:center;
}
.admin-links{
    text-align:center;
    margin-top:15px;
}
.admin-links a{
    color:#7c3aed;
    text-decoration:none;
    margin:0 10px;
    font-weight:600;
}
.admin-links a:hover{
    text-decoration:underline;
}
</style>
</head>
<body>

<h1>Generate API Key</h1>

<div class="box">
    <label>Firstname</label>
    <input type="text" id="firstname" placeholder="Firstname">
    <label>Lastname</label>
    <input type="text" id="lastname" placeholder="Lastname">
    <label>Email</label>
    <input type="email" id="email" placeholder="Email">
    <button onclick="generateUser()">Save & Generate API Key</button>
    <p id="status"></p>
</div>

<div class="admin-links">
    <p>Admin? <a href="login.html">Login</a> | <a href="register.html">Register</a></p>
</div>

<script>
async function generateUser(){
    const status = document.getElementById('status');
    const firstname = document.getElementById('firstname').value.trim();
    const lastname = document.getElementById('lastname').value.trim();
    const email = document.getElementById('email').value.trim();

    if(!firstname || !lastname || !email){
        status.innerHTML = "⚠ Semua field wajib diisi!";
        status.style.color = "red";
        return;
    }

    status.innerHTML = "⏳ Memproses...";
    status.style.color = "#000";

    try{
        const res = await fetch('/users/create',{
            method:'POST',
            headers:{'Content-Type':'application/json'},
            body: JSON.stringify({ firstname, lastname, email })
        });
        const data = await res.json();

        if(data.success){
            status.innerHTML = `✅ API Key berhasil dibuat: <b>${data.data.apiKey}</b>`;
            status.style.color = "green";
            document.getElementById('firstname').value='';
            document.getElementById('lastname').value='';
            document.getElementById('email').value='';
        } else {
            status.innerHTML = `❌ ${data.message}`;
            status.style.color = "red";
        }
    } catch(err){
        status.innerHTML = "❌ Error server. Coba lagi.";
        status.style.color = "red";
        console.error(err);
    }
}
</script>

</body>
</html>
